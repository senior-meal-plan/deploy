<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê°•ì œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸</title>
</head>
<body>
    <h1>PC ì•Œë¦¼ í…ŒìŠ¤íŠ¸ (Foreground ê°•ì œ)</h1>
    <h3 style="color: blue;" id="token-area">í† í° ë¡œë”©ì¤‘...</h3>
    <div id="log-area"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBUtGZ5A3MSDYjQnRguBx3dLuS9FKT2GQU",
            authDomain: "senior-meal-plan.firebaseapp.com",
            projectId: "senior-meal-plan",
            storageBucket: "senior-meal-plan.firebasestorage.app",
            messagingSenderId: "725290202600",
            appId: "1:725290202600:web:773c67b19c879435a1605d",
            measurementId: "G-YEECGP9T6J"
        };
        
        // VAPID KEY ì…ë ¥ í•„ìˆ˜
        const VAPID_KEY = "BKOyBwah8kVPSNeAokU9OKNXbLWypdugwnZUWo4X3ZzjV4ldBkZfZIh2i4CAlIaFK5sbU4t0yQsXZIlqd5HgOXs"; 

        const app = initializeApp(firebaseConfig);
        const messaging = getMessaging(app);

        // [í•µì‹¬] ë³´ê³  ìˆì„ ë•Œë„ ì•Œë¦¼ì„ ê°•ì œë¡œ ë„ìš°ëŠ” ì½”ë“œ
        onMessage(messaging, (payload) => {
            console.log('ë©”ì‹œì§€ ìˆ˜ì‹ :', payload);
            const logDiv = document.getElementById("log-area");
            logDiv.innerHTML += `<p>ğŸ“© ë©”ì‹œì§€ ë„ì°©! ì œëª©: ${payload.notification.title}</p>`;

            // ë¸Œë¼ìš°ì € ì•Œë¦¼ ì§ì ‘ í˜¸ì¶œ
            new Notification(payload.notification.title, {
                body: payload.notification.body,
            });
        });

        async function getMyToken() {
            try {
                // ê¶Œí•œ ë‹¤ì‹œ í•œ ë²ˆ í™•ì‹¤í•˜ê²Œ ìš”ì²­
                const permission = await Notification.requestPermission();
                if (permission !== 'granted') {
                    alert("ì•Œë¦¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”!");
                    return;
                }

                const currentToken = await getToken(messaging, { vapidKey: VAPID_KEY });
                if (currentToken) {
                    console.log("í† í°:", currentToken);
                    document.getElementById("token-area").innerText = currentToken;
                    document.getElementById("token-area").onclick = () => {
                        navigator.clipboard.writeText(currentToken);
                        alert("ë³µì‚¬ë¨");
                    };
                }
            } catch (err) {
                console.error('ì—ëŸ¬:', err);
                document.getElementById("token-area").innerText = "ì—ëŸ¬ë°œìƒ: " + err;
            }
        }

        getMyToken();
    </script>
</body>
</html>